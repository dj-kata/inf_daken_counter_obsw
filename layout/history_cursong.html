<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <title>hoge</title>
        <style>
            body { 
            
            background-color: rgba(0, 0, 0, 0.85);
            margin: 10px;
            padding: 10px;
            overflow: hidden;
            font-family:"Meiryo";
            color:#2196F3;   
            font-size: 64px;
            color: #fff;
            text-shadow: 6px 6px 0 #000,
                         -2px 2px 0 #000,
                         2px -2px 0 #000,
                         -2px -2px 0 #000;
            }
            table#title {
                color: #aaddff;
                background-color: rgba(0, 0, 0, 0.95);
                font-size: 130px;
                line-height: 130%;
                width:100%;
            }
            table#title td{
            	white-space:nowrap;
            }
            table#title td:nth-child(1){
                width:20%;
            }
            table#title td:nth-child(2){
            	overflow:hidden;
            	text-overflow:ellipsis;
            	max-width:100px;
            }
            table#title td:nth-child(3){
                width:17%;
            }
            table#result {
                font-size: 96px;
            	width:100%;
            }
            table#result td {
            	white-space:nowrap;
            }
            table#result td:nth-child(1) {
            	width:25%;
            }
            table#result td:nth-child(2) {
            	width:12%;
            }
            table#result td:nth-child(3) {
            	width:19%;
            }
            table#result td:nth-child(4) {
            	max-width:90%;
            }
        </style>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <script>
        function loadXml() {
            var getxml = $.ajax({
                url: '../history_cursong.xml',
                type: 'GET',
                dataType: 'xml',
                cache: false
            });
            getxml.done(function(xml){
                // xmlデータからほしいデータをfindで探し処理
                var out = "";
                var title = $(xml).find('Results music').text();
                var lv = $(xml).find('Results lv').text();
                var difficulty = $(xml).find('Results difficulty').text();
                $("#title tbody").html('<tr><td>☆'+lv+'</td><td>'+title+'</td><td>('+difficulty+')</td></tr>');
                $(xml).find("Results item").each(function(index, item){
                    var date = $(item).find('date').text();
                    var lamp = $(item).find('lamp').text();
                    var score = $(item).find('score').text();
                    var opt = $(item).find('opt').text();
                    var bp = $(item).find('bp').text();
                    var dbflg = false;
                    if (lamp == "FAILED"){
                        lamp = '<font color="#ff0000">x</font>'
                    }
                    else if (lamp == "A-CLEAR"){
                        lamp = '<font color="#cc44ff">AC</font>'
                    }
                    else if (lamp == "E-CLEAR"){
                        lamp = '<font color="#00ff22">EC</font>'
                    }
                    else if (lamp == "CLEAR"){
                        lamp = '<font color="#22aaff">NC</font>'
                    }
                    else if (lamp == "H-CLEAR"){
                        lamp = '<font color="#ff2222">HC</font>'
                    }
                    else if (lamp == "EXH-CLEAR"){
                        lamp = '<font color="#ffff22">EXH</font>'
                    }
                    else if (lamp == "F-COMBO"){
                        lamp = '<font color="#ff22ff">FC</font>'
                    }
                    else{ // No playは何も表示しない
                        lamp = ''
                    }
                    if (opt.indexOf("BATTLE")>=0){
                        dbflg = true;
                    }
                    // 長いオプションを省略する(字をデカくするための施策,お好みで消してください)
                    if (opt.indexOf("BATTLE, OFF / MIR")>=0){
                        opt = '(DBM;右M)'
                    }
                    else if (opt.indexOf("BATTLE, MIR / OFF")>=0){
                        opt = '(DBM;左M)'
                    }
                    else if (opt.indexOf("BATTLE, OFF / OFF")>=0){
                        opt = '(DB)'
                    }
                    else if (opt.indexOf("BATTLE, RAN / RAN")>=0){
                        opt = '(DBR)'
                    }
                    else if (opt.indexOf("BATTLE, S-RAN / S-RAN")>=0){
                        opt = '(DBSR)'
                    }
                    else if (opt.indexOf("BATTLE, H-RAN / H-RAN")>=0){
                        opt = '(DBHR)'
                    }
                    else if (opt.indexOf("S-RAN / S-RAN, FLIP, LEGACY")>=0){
                        opt = '(全裸)'
                    }
                    // テーブルに追加
                    if (dbflg == true){ // DBx系オプションの場合、スコアの所にbp250のようにミスカンを入れておく
                        out +='<tr><td><font color="#ffffaa">'+date+'</font></td><td>'+lamp+'</td><td>bp'+bp+'</td><td><font color="#aaffaa">'+opt+'</font></td></tr>';
                    }else{
                        out +='<tr><td><font color="#ffffaa">'+date+'</font></td><td>'+lamp+'</td><td>'+score+'</td><td><font color="#aaffaa">'+opt+'</font></td></tr>';
                    }
                    if (index == 19){ // 直近の20プレイだけ表示としている。曲数はここから変更可能。
                        return false;
                    }
                    });
                $('#result tbody').html(out);
            });
            getxml.fail(function(err) {
                $(songtitle).text("ERROR!!!"+err);
                //alert('failed');
            });
        }

        window.addEventListener('DOMContentLoaded', function() {
            var roopTimer = setInterval(loadXml, 50);
        });

</script>
</head>
<body>
  <table id="title">
    <tbody>
    </tbody>
  </table>
  <table id="result">
    <tbody>
    </tbody>
  </table>
</body>
</html>