<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="utf-8">
    <title>Today's Stats</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=RocknRoll+One&display=swap" rel="stylesheet">
    <style>
        * {
            box-sizing: border-box;
        }
        
        body { 
            background: transparent;
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: 'RocknRoll One', sans-serif;
            color: #fff;
        }
        
        .container {
            background: linear-gradient(135deg, rgba(0, 20, 100, 0.9), rgba(0, 40, 120, 0.9));
            padding: 15px 20px;
            box-shadow: 0 5px 20px rgba(33, 150, 243, 0.3);
            border: 2px solid rgba(33, 150, 243, 0.3);
            width: 100%;
        }
        
        /* ヘッダー */
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        
        .today-label {
            font-size: 36px;
            color: #ffffff;
            text-shadow: 3px 3px 0 #000,
                        -2px 2px 0 #000,
                        2px -2px 0 #000,
                        -2px -2px 0 #000;
        }
        
        .today-notes {
            font-size: 42px;
            color: #ffeb3b;
            text-shadow: 0 0 20px rgba(255, 235, 59, 0.5),
                        3px 3px 0 #000,
                        -2px 2px 0 #000,
                        2px -2px 0 #000,
                        -2px -2px 0 #000;
            font-weight: bold;
        }
        
        /* グラフエリア */
        .graph-area {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 12px 15px;
            margin-bottom: 12px;
        }
        
        .bar-container {
            display: flex;
            height: 35px;
            border-radius: 5px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
        }
        
        .bar-segment {
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: bold;
            color: #fff;
            text-shadow: 1px 1px 2px #000;
        }
        
        .bar-pg {
            background: linear-gradient(180deg, #00AAFF, #0088DD);
        }
        
        .bar-gr {
            background: linear-gradient(180deg, #00DDFF, #00BBDD);
        }
        
        .bar-gd {
            background: linear-gradient(180deg, #FFBB00, #DD9900);
        }
        
        .bar-bad {
            background: linear-gradient(180deg, #DD4445, #BB2222);
        }
        
        /* 統計情報 */
        .stats {
            display: flex;
            gap: 15px;
            font-size: 24px;
            text-shadow: 2px 2px 0 #000;
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .stat-label {
            color: #aaddff;
        }
        
        .stat-value {
            color: #ffffaa;
            font-weight: bold;
        }
        
        .stat-cur {
            color: #aaa;
            font-size: 20px;
        }
    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
    function updateGraph() {
        $.ajax({
            url: "../out/graph.xml",
            type: 'GET',
            dataType: 'xml',
            cache: false,
            timeout: 10000
        }).done(function(xml) {
            // データ取得
            var pg = Number($(xml).find('pg').text()) || 0;
            var gr = Number($(xml).find('gr').text()) || 0;
            var gd = Number($(xml).find('gd').text()) || 0;
            var bd = Number($(xml).find('bd').text()) || 0;
            var pr = Number($(xml).find('pr').text()) || 0;
            var playcount = Number($(xml).find('playcount').text()) || 0;
            var today_notes = Number($(xml).find('today_notes').text()) || 0;
            var today_score_rate = $(xml).find('today_score_rate').text() || '0%';
            var current_score_rate = $(xml).find('current_score_rate').text() || '0%';
            
            // BAD判定の合計
            var bad_total = bd + pr;
            
            // 合計ノーツ（グラフ用）
            var total = pg + gr + gd + bad_total;
            
            // パーセンテージ計算
            var pg_percent = total > 0 ? (pg / total * 100) : 0;
            var gr_percent = total > 0 ? (gr / total * 100) : 0;
            var gd_percent = total > 0 ? (gd / total * 100) : 0;
            var bad_percent = total > 0 ? (bad_total / total * 100) : 0;
            
            // 表示更新
            $('.today-notes').text(today_notes.toLocaleString());
            $('#play-value').text(playcount);
            $('#rate-value').text(today_score_rate);
            $('#cur-value').text('(' + current_score_rate + ')');
            
            // グラフ更新
            $('#bar-pg').css('width', pg_percent + '%');
            $('#bar-gr').css('width', gr_percent + '%');
            $('#bar-gd').css('width', gd_percent + '%');
            $('#bar-bad').css('width', bad_percent + '%');
        }).fail(function(err) {
            console.error('XMLロードエラー:', err);
        });
    }
    
    window.addEventListener('DOMContentLoaded', function() {
        updateGraph();
        setInterval(updateGraph, 300);
    });
    </script>
</head>
<body>
    <div class="container">
        <!-- ヘッダー -->
        <div class="header">
            <div class="today-label">today</div>
            <div class="today-notes">0</div>
        </div>
        
        <!-- グラフ -->
        <div class="graph-area">
            <div class="bar-container">
                <div id="bar-bad" class="bar-segment bar-bad" style="width: 0%"></div>
                <div id="bar-gd" class="bar-segment bar-gd" style="width: 0%"></div>
                <div id="bar-gr" class="bar-segment bar-gr" style="width: 0%"></div>
                <div id="bar-pg" class="bar-segment bar-pg" style="width: 0%"></div>
            </div>
        </div>
        
        <!-- 統計情報 -->
        <div class="stats">
            <div class="stat-item">
                <span class="stat-label">play:</span>
                <span class="stat-value" id="play-value">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">rate:</span>
                <span class="stat-value" id="rate-value">0%</span>
            </div>
            <div class="stat-item">
                <span class="stat-cur" id="cur-value">(0%)</span>
            </div>
        </div>
    </div>
</body>
</html>