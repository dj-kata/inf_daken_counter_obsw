<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <title>IIDX Score History</title>
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=RocknRoll+One&display=swap" rel="stylesheet">
        <style>
            * {
                box-sizing: border-box;
            }
            
            body { 
                background: linear-gradient(135deg, #0a0a1f 0%, #1a1a3e 50%, #0a0a1f 100%);
                margin: 0;
                padding: 10px;
                overflow: hidden;
                font-family: "RocknRoll One", sans-serif;
                color: #fff;
            }
            
            #all {
                max-width: 1900px;
                margin: 0 auto;
            }
            
            /* „Çø„Ç§„Éà„É´„Çª„ÇØ„Ç∑„Éß„É≥ - Êñ∞„É¨„Ç§„Ç¢„Ç¶„Éà */
            .title-card {
                background: linear-gradient(135deg, rgba(0, 20, 100, 0.9), rgba(0, 40, 120, 0.9));
                border-radius: 12px;
                padding: 12px 25px;
                margin-bottom: 10px;
                box-shadow: 0 5px 20px rgba(33, 150, 243, 0.3);
                border: 2px solid rgba(33, 150, 243, 0.3);
            }
            
            .title-content {
                display: flex;
                align-items: center;
                justify-content: space-between;
                gap: 30px;
            }
            
            .title-name {
                font-size: 48px;
                flex-grow: 1;
                text-shadow: 3px 3px 0 #000,
                            -2px 2px 0 #000,
                            2px -2px 0 #000,
                            -2px -2px 0 #000;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
                color: #ffffff;
            }
            
            .title-info {
                display: flex;
                flex-direction: column;
                gap: 5px;
                min-width: 280px;
                text-align: right;
            }
            
            .title-level-difficulty {
                font-size: 40px;
                text-shadow: 3px 3px 0 #000,
                            -2px 2px 0 #000,
                            2px -2px 0 #000,
                            -2px -2px 0 #000;
                white-space: nowrap;
            }
            
            .title-level {
                color: #ffeb3b;
                text-shadow: 0 0 20px rgba(255, 235, 59, 0.5),
                            3px 3px 0 #000,
                            -2px 2px 0 #000,
                            2px -2px 0 #000,
                            -2px -2px 0 #000;
            }
            
            .title-difficulty {
                margin-left: 15px;
            }
            
            /* Èõ£ÊòìÂ∫¶„ÅÆËâ≤ÂàÜ„Åë */
            .diff-a { color: #ff4444; }  /* Another - Ëµ§ */
            .diff-b { color: #44ff44; }  /* Beginner - Á∑ë */
            .diff-n { color: #4444ff; }  /* Normal - Èùí */
            .diff-h { color: #ffff44; }  /* Hyper - ÈªÑËâ≤ */
            .diff-l { color: #ff44ff; }  /* Leggendaria - Á¥´ */
            
            .title-notes {
                font-size: 28px;
                color: #aaaaff;
                text-shadow: 2px 2px 0 #000,
                            -1px 1px 0 #000,
                            1px -1px 0 #000,
                            -1px -1px 0 #000;
            }
            
            /* BEST„Çª„ÇØ„Ç∑„Éß„É≥ - Ê®™‰∏¶„Å≥„É¨„Ç§„Ç¢„Ç¶„Éà */
            .best-section {
                display: flex;
                gap: 10px;
                margin-bottom: 10px;
            }
            
            .best-card {
                background: linear-gradient(135deg, rgba(30, 30, 60, 0.9), rgba(20, 20, 40, 0.9));
                border-radius: 12px;
                padding: 12px 20px;
                box-shadow: 0 5px 20px rgba(0, 0, 0, 0.4);
                border: 2px solid rgba(100, 100, 200, 0.3);
                flex: 1;
            }
            
            .best-card h2 {
                font-size: 26px;
                margin: 0 0 8px 0;
                color: #ce93d8;
                text-shadow: 2px 2px 0 #000;
            }
            
            .best-item {
                display: grid;
                grid-template-columns: auto 1fr;
                gap: 20px;
                align-items: center;
            }
            
            .best-value {
                font-size: 48px;
                color: #fff;
                text-shadow: 2px 2px 0 #000;
                font-weight: bold;
                text-align: center;
            }
            
            .best-right-column {
                display: flex;
                flex-direction: column;
                gap: 3px;
                text-align: right;
            }
            
            .best-detail {
                font-size: 28px;
                color: #aaa;
            }
            
            .best-option {
                font-size: 22px;
                color: #77bb77;
                text-shadow: 2px 2px 0 #000;
            }
            
            /* BPIÂ∞ÇÁî®„Ç´„Éº„Éâ - Ê®™‰∏¶„Å≥„É¨„Ç§„Ç¢„Ç¶„Éà */
            .bpi-card {
                background: linear-gradient(135deg, rgba(50, 30, 80, 0.9), rgba(30, 20, 50, 0.9));
                border: 2px solid rgba(206, 147, 216, 0.5);
                flex: 1.5;
                display: none; /* „Éá„Éï„Ç©„É´„Éà„ÅßÈùûË°®Á§∫ */
            }
            
            .bpi-card.visible {
                display: block; /* BPI„Éá„Éº„Çø„Åå„ÅÇ„ÇãÂ†¥Âêà„Å´Ë°®Á§∫ */
            }
            
            .bpi-card h2 {
                color: #e1bee7;
            }
            
            .bpi-grid {
                display: flex;
                gap: 15px;
                justify-content: space-between;
            }
            
            .bpi-item {
                flex: 1;
                text-align: center;
            }
            
            .bpi-item-label {
                font-size: 20px;
                color: #ce93d8;
                margin-bottom: 5px;
            }
            
            .bpi-item-value {
                font-size: 30px;
                color: #fff;
                text-shadow: 0 0 10px rgba(206, 147, 216, 0.5),
                            2px 2px 0 #000;
                font-weight: bold;
            }
            
            .bpi-comparison {
                font-size: 18px;
                margin-top: 3px;
                font-weight: bold;
            }
            
            .bpi-comparison.positive {
                color: #44ff44;
                text-shadow: 0 0 5px rgba(68, 255, 68, 0.5);
            }
            
            .bpi-comparison.negative {
                color: #ff4444;
                text-shadow: 0 0 5px rgba(255, 68, 68, 0.5);
            }
            
            /* „É™„Ç∂„É´„Éà„ÉÜ„Éº„Éñ„É´ - „Ç≥„É≥„Éë„ÇØ„ÉàÂåñ */
            .result-card {
                background: linear-gradient(135deg, rgba(30, 30, 60, 0.9), rgba(20, 20, 40, 0.9));
                border-radius: 12px;
                padding: 12px 20px;
                box-shadow: 0 5px 20px rgba(0, 0, 0, 0.4);
                border: 2px solid rgba(100, 100, 200, 0.3);
            }
            
            .result-card h2 {
                font-size: 28px;
                margin: 0 0 8px 0;
                color: #81d4fa;
                text-shadow: 2px 2px 0 #000;
            }
            
            table#result {
                width: 100%;
                border-collapse: collapse;
            }
            
            table#result tr {
                border-bottom: 1px solid rgba(255, 255, 255, 0.05);
                transition: background-color 0.2s;
            }
            
            table#result tr:hover {
                background-color: rgba(255, 255, 255, 0.05);
            }
            
            table#result td {
                padding: 6px 5px;
                white-space: nowrap;
                font-size: 32px;
                text-shadow: 2px 2px 0 #000;
            }
            
            table#result td:nth-child(1) {
                width: 20%;
                color: #ffffaa;
            }
            
            table#result td:nth-child(2) {
                width: 4%;
            }
            
            table#result td:nth-child(3) {
                width: 14%;
                text-align: right;
                font-weight: bold;
            }
            
            table#result td:nth-child(4) {
                width: 18%;
                text-align: center;
            }
            
            table#result td:nth-child(5) {
                width: 44%;
                overflow: hidden;
                text-overflow: ellipsis;
                color: #aaffaa;
            }
            
            /* „É©„É≥„ÇØ„Ç´„É©„Éº */
            .MAX {
                animation: flashmax 0.4s infinite;
                font-weight: bold;
            }
            
            @keyframes flashmax {
                0%   { color: #ff2828; }
                20%  { color: #d5ff28; }
                40%  { color: #28ff7e; }
                60%  { color: #2872ff; }
                80%  { color: #d528ff; }
                100% { color: #ff2828; }
            }
            
            .AAA { color: #ffff28; font-weight: bold; }
            .AA { color: #c3c3c3; font-weight: bold; }
            .A { color: #2ddf71; }
            .B { color: #7777ff; }
            
            /* „ÇØ„É™„Ç¢„É©„É≥„Éó */
            .lamp-box {
                display: inline-block;
                width: 25px;
                height: 25px;
                border-radius: 4px;
                vertical-align: middle;
            }
            
            .fc { animation: flashfc 0.2s infinite; }
            @keyframes flashfc {
                0%   { background-color: #ff2828; }
                20%  { background-color: #d5ff28; }
                40%  { background-color: #28ff7e; }
                60%  { background-color: #2872ff; }
                80%  { background-color: #d528ff; }
                100% { background-color: #ff2828; }
            }
            
            .failed { animation: flashfailed 0.08s infinite; }
            @keyframes flashfailed {
                0%   { background-color: #ff2828; }
                50%  { background-color: #282828; }
                100% { background-color: #ff2828; }
            }
            
            .ac { background-color: #ff66ff; }
            .ec { background-color: #22ff22; }
            .nc { background-color: #22ccff; }
            .hc { background-color: #ffffff; }
            
            .exh { animation: flashexh 0.08s infinite; }
            @keyframes flashexh {
                0%   { background-color: #ff2828; }
                50%  { background-color: #ffff28; }
                100% { background-color: #ff2828; }
            }
        </style>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <script>
        function getDifficultyColor(difficulty) {
            // Èõ£ÊòìÂ∫¶„ÅÆ3ÊñáÂ≠óÁõÆ„ÇíÂèñÂæó
            if (!difficulty || difficulty.length < 3) return '';
            var diffType = difficulty.charAt(2).toUpperCase();
            
            switch(diffType) {
                case 'A': return 'diff-a';  // Another - Ëµ§
                case 'B': return 'diff-b';  // Beginner - Á∑ë
                case 'N': return 'diff-n';  // Normal - Èùí
                case 'H': return 'diff-h';  // Hyper - ÈªÑËâ≤
                case 'L': return 'diff-l';  // Leggendaria - Á¥´
                default: return '';
            }
        }
        
        function loadXml() {
            var getxml = $.ajax({
                url: '../out/history_cursong.xml',
                type: 'GET',
                dataType: 'xml',
                timeout: 10000,
                cache: false,
            });
            
            getxml.done(function(xml) {
                var out = '';
                var title = $(xml).find('music').text();
                var difficulty = $(xml).find('difficulty').text();
                var lv = $(xml).find('lv').text();
                var notes = Number($(xml).find('notes').text());
                var best_lamp = $(xml).find('best_lamp').text();
                var best_score = Number($(xml).find('best_score').text());
                var best_bp = $(xml).find('best_bp').text();
                if (best_bp == '99999999'){
                    best_bp = "";
                }
                var best_lamp_opt = $(xml).find('best_lamp_opt').text();
                var best_score_opt = $(xml).find('best_score_opt').text();
                var best_bp_opt = $(xml).find('best_bp_opt').text();
                var best_score_rate = Number($(xml).find('best_score_rate').text());
                var best_notes = Number($(xml).find('notes').text());
                var best_bpi = $(xml).find('best_bpi').text();
                var bpi_ave = $(xml).find('bpi_ave').text();
                var bpi_top = $(xml).find('bpi_top').text();
                var best_bp_rate = $(xml).find('best_bp_rate').text();
                
                // „É©„É≥„ÇØÂà§ÂÆö
                var best_rank = "B";
                if (best_score_rate * 18 > 16) {
                    best_rank = 'AAA';
                } else if (best_score_rate * 18 > 14) {
                    best_rank = 'AA';
                } else if (best_score_rate * 18 > 12) {
                    best_rank = 'A';
                }
                
                var best_rankdiff0 = $(xml).find('best_rankdiff0').text();
                var best_rankdiff1 = $(xml).find('best_rankdiff1').text();
                var best_rankdiff = '<span class="' + best_rank + '">' + best_rankdiff0 + '</span>' + best_rankdiff1;
                
                // MAX„ÉÅ„Çß„ÉÉ„ÇØ
                if (best_score == best_notes * 2 && best_notes > 0) {
                    best_rankdiff = '<span class="MAX">MAX</span>';
                }
                
                // „Çø„Ç§„Éà„É´Ë°®Á§∫
                $('.title-name').text(title);
                
                // Èõ£ÊòìÂ∫¶„ÅÆËâ≤„ÇíÂèñÂæó
                var diffColorClass = getDifficultyColor(difficulty);
                $('.title-level-difficulty').html(
                    '<span class="title-level">‚òÜ' + lv + '</span>' +
                    '<span class="title-difficulty ' + diffColorClass + '">' + difficulty + '</span>'
                );
                
                // „Éé„Éº„ÉÑÊï∞Ë°®Á§∫
                $('.title-notes').text(notes.toLocaleString() + ' notes');
                
                // BEST„Çπ„Ç≥„Ç¢Ë°®Á§∫
                var best_html = '';
                best_html += '<div class="best-item">';
                best_html += '<div class="best-value">' + best_score + '</div>';
                best_html += '<div class="best-right-column">';
                best_html += '<div class="best-detail">' + best_rankdiff + '</div>';
                best_html += '<div class="best-option">' + best_score_opt + '</div>';
                best_html += '</div>';
                best_html += '</div>';
                $('.score-info').html(best_html);
                
                // BEST BPË°®Á§∫
                var bp_html = '';
                bp_html += '<div class="best-item">';
                bp_html += '<div class="best-value">' + best_bp + '</div>';
                bp_html += '<div class="best-right-column">';
                bp_html += '<div class="best-detail">(' + best_bp_rate + '%)</div>';
                bp_html += '<div class="best-option">' + best_bp_opt + '</div>';
                bp_html += '</div>';
                bp_html += '</div>';
                $('.bp-info').html(bp_html);
                
                // BPIÊÉÖÂ†±„ÅÆË°®Á§∫Âà§ÂÆö
                var hasBpiData = bpi_ave && bpi_ave !== '' && bpi_ave !== '0' && 
                                 bpi_top && bpi_top !== '' && bpi_top !== '0' &&
                                 best_bpi && best_bpi !== '';
                
                if (hasBpiData) {
                    $('.bpi-card').addClass('visible');
                    
                    var bpi_ave_num = Number(bpi_ave);
                    var bpi_top_num = Number(bpi_top);
                    
                    // BPIÊÉÖÂ†±Ë°®Á§∫
                    var bpi_html = '';
                    bpi_html += '<div class="bpi-item">';
                    bpi_html += '<div class="bpi-item-label">Ëá™Â∑±„Éô„Çπ„Éà</div>';
                    bpi_html += '<div class="bpi-item-value">' + best_bpi + '</div>';
                    bpi_html += '</div>';
                    
                    bpi_html += '<div class="bpi-item">';
                    bpi_html += '<div class="bpi-item-label">ÁöÜ‰ºùÂπ≥Âùá</div>';
                    bpi_html += '<div class="bpi-item-value">' + bpi_ave_num.toLocaleString() + '</div>';
                    var diff_ave = best_score - bpi_ave_num;
                    var diff_ave_str = (diff_ave >= 0 ? '+' : '') + diff_ave;
                    var diff_ave_class = diff_ave >= 0 ? 'positive' : 'negative';
                    bpi_html += '<div class="bpi-comparison ' + diff_ave_class + '">' + diff_ave_str + '</div>';
                    bpi_html += '</div>';
                    
                    bpi_html += '<div class="bpi-item">';
                    bpi_html += '<div class="bpi-item-label">ÂÖ®ÂõΩTOP</div>';
                    bpi_html += '<div class="bpi-item-value">' + bpi_top_num.toLocaleString() + '</div>';
                    var diff_top = best_score - bpi_top_num;
                    var diff_top_str = (diff_top >= 0 ? '+' : '') + diff_top;
                    var diff_top_class = diff_top >= 0 ? 'positive' : 'negative';
                    bpi_html += '<div class="bpi-comparison ' + diff_top_class + '">' + diff_top_str + '</div>';
                    bpi_html += '</div>';
                    
                    $('.bpi-info').html(bpi_html);
                } else {
                    $('.bpi-card').removeClass('visible');
                }
                
                // „Éó„É¨„Ç§Â±•Ê≠¥
                $(xml).find("Results item").each(function(index, item) {
                    var date = $(item).find('date').text();
                    var lamp = Number($(item).find('lamp').text());
                    var score = Number($(item).find('score').text());
                    var score_rate = Number($(item).find('score_rate').text());
                    var opt = $(item).find('opt').text();
                    var bp = $(item).find('bp').text();
                    var notes = Number($(item).find('notes').text());
                    
                    var rank = "B";
                    if (score_rate * 18 > 16) {
                        rank = 'AAA';
                    } else if (score_rate * 18 > 14) {
                        rank = 'AA';
                    } else if (score_rate * 18 > 12) {
                        rank = 'A';
                    }
                    
                    var rankdiff0 = $(item).find('rankdiff0').text();
                    var rankdiff1 = $(item).find('rankdiff1').text();
                    var rankdiff = '<span class="' + rank + '">' + rankdiff0 + '</span>' + rankdiff1;
                    
                    if (score == notes * 2 && notes > 0) {
                        rankdiff = '<span class="MAX">MAX</span>';
                    }
                    
                    // „É©„É≥„ÉóË°®Á§∫
                    var lamp_html = '';
                    if (lamp == 1) {
                        lamp_html = '<span class="lamp-box failed"></span>';
                    } else if (lamp == 2) {
                        lamp_html = '<span class="lamp-box ac"></span>';
                    } else if (lamp == 3) {
                        lamp_html = '<span class="lamp-box ec"></span>';
                    } else if (lamp == 4) {
                        lamp_html = '<span class="lamp-box nc"></span>';
                    } else if (lamp == 5) {
                        lamp_html = '<span class="lamp-box hc"></span>';
                    } else if (lamp == 6) {
                        lamp_html = '<span class="lamp-box exh"></span>';
                    } else if (lamp == 7) {
                        lamp_html = '<span class="lamp-box fc"></span>';
                    }
                    
                    var dbflg = false;
                    var with_scratch = "";
                    if (opt.indexOf("BATTLE") >= 0) {
                        dbflg = true;
                        if (opt.indexOf("A-SCR") < 0) {
                            with_scratch = ", Áöø„ÅÇ„Çä";
                        }
                    }
                    
                    // „Ç™„Éó„Ç∑„Éß„É≥ÁúÅÁï•
                    if (opt.indexOf("BATTLE, OFF / MIR") >= 0) {
                        opt = '(DBM;Âè≥M' + with_scratch + ')';
                    } else if (opt.indexOf("BATTLE, MIR / OFF") >= 0) {
                        opt = '(DBM;Â∑¶M' + with_scratch + ')';
                    } else if (opt.indexOf("BATTLE, OFF / OFF") >= 0) {
                        opt = '(DB' + with_scratch + ')';
                    } else if (opt.indexOf("BATTLE, RAN / RAN") >= 0) {
                        opt = '(DBR' + with_scratch + ')';
                    } else if (opt.indexOf("BATTLE, S-RAN / S-RAN") >= 0) {
                        opt = '(DBSR' + with_scratch + ')';
                    } else if (opt.indexOf("BATTLE, H-RAN / H-RAN") >= 0) {
                        opt = '(DBHR' + with_scratch + ')';
                    } else if (opt.indexOf("S-RAN / S-RAN, FLIP, LEGACY") >= 0) {
                        opt = '(ÂÖ®Ë£∏' + with_scratch + ')';
                    }
                    
                    // „ÉÜ„Éº„Éñ„É´Ë°åËøΩÂä†
                    if (dbflg) {
                        out += '<tr>';
                        out += '<td>' + date + '</td>';
                        out += '<td>' + lamp_html + '</td>';
                        out += '<td>bp' + bp + '</td>';
                        out += '<td></td>';
                        out += '<td>' + opt + '</td>';
                        out += '</tr>';
                    } else {
                        out += '<tr>';
                        out += '<td>' + date + '</td>';
                        out += '<td>' + lamp_html + '</td>';
                        out += '<td>' + score + '</td>';
                        out += '<td>' + rankdiff + '</td>';
                        out += '<td>' + opt + '</td>';
                        out += '</tr>';
                    }
                    
                    if (index == 19) {
                        return false;
                    }
                });
                
                $('#result tbody').html(out);
            });
            
            getxml.fail(function(err) {
                console.error('XML„É≠„Éº„Éâ„Ç®„É©„Éº:', err);
            });
        }
        
        window.addEventListener('DOMContentLoaded', function() {
            loadXml();
            setInterval(loadXml, 1000);
        });
        </script>
    </head>
    <body>
        <div id="all">
            <!-- „Çø„Ç§„Éà„É´„Ç´„Éº„Éâ -->
            <div class="title-card">
                <div class="title-content">
                    <div class="title-name"></div>
                    <div class="title-info">
                        <div class="title-level-difficulty"></div>
                        <div class="title-notes"></div>
                    </div>
                </div>
            </div>
            
            <!-- BEST„Çª„ÇØ„Ç∑„Éß„É≥ - Ê®™‰∏¶„Å≥ -->
            <div class="best-section">
                <!-- „Çπ„Ç≥„Ç¢„Ç´„Éº„Éâ -->
                <div class="best-card">
                    <h2>üìä SCORE</h2>
                    <div class="score-info"></div>
                </div>
                
                <!-- BP„Ç´„Éº„Éâ -->
                <div class="best-card">
                    <h2>üíî BP</h2>
                    <div class="bp-info"></div>
                </div>
                
                <!-- BPI„Ç´„Éº„Éâ - Êù°‰ª∂‰ªò„ÅçË°®Á§∫ -->
                <div class="best-card bpi-card">
                    <h2>üìà BPI INFO</h2>
                    <div class="bpi-grid bpi-info"></div>
                </div>
            </div>
            
            <!-- „É™„Ç∂„É´„Éà„Ç´„Éº„Éâ -->
            <div class="result-card">
                <h2>üìú HISTORY</h2>
                <table id="result">
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </body>
</html>